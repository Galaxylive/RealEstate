{% extends "core/base.html" %}
{% load staticfiles %}

{% block header %}
   <h2><strong>REPORT</strong></h2>
{% endblock header %}

{% block body %}

    <div class="container">
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#graphics">Graphics</a></li>
            <li><a data-toggle="tab" href="#numbers">Numbers</a></li>
        </ul>

        <div class="tab-content">

            <!--GRAPHICS TAB!!-->
            <div id="graphics" class="tab-pane fade in active">
                <h3>GRAPHICS</h3>
                <p>A simplified visual representation of all collected data for a quick breakdowns and decision making.</p>

                <hr>

                <div class="row">
                    <h2>Shared Category Importance</h2>
                    <h5>See what is most important in a house.</h5>
                    <div class="col-lg-12 row">
                        <div class="col-lg-9">
                            <div><canvas id="PieChart" style="height:400px; width: 100%"></canvas></div>
                        </div>
                        <div class="col-lg-3">
                            <div id="lineLegend"></div>
                        </div>
                    </div>
                </div>

                <hr>

                <div class="row">
                    <div class="col-lg-12">
                        <h2>Weighting</h2>
                        <div class="row">
                            <div class="col-lg-8"><canvas id="myChart" style="height:400px; width: 100%"></canvas></div>
                            <div class="col-lg-3"> 
                                <div id="barLegend"></div>
                            </div>
                    </div>
                </div>
            </div>

                <hr>

                <h2>Category Data</h2>
                {% for category, houses in categoryData %}
                    <div class="col-lg-4">
                        <div class="col-lg-10"><center>
                            <h5>{{ category }}</h5>
                            <canvas id="{{category}}bar" style="height:400px; width: 300px"></canvas>
                        </center></div>
                    </div>
                {% endfor %}
            </div>
            <!--NUMBERS TAB!!-->
            <div id="numbers" class="tab-pane fade">
                <h3>NUMBERS</h3>
                <p>For the nerd within. Read though all the data in its raw, numeric format.</p>

                <h2>Weighting</h2>
                {% for category, weight1, weight2 in categoryImportance %}
                    <h4>{{category}}</h4>
                    <h5>{{weight1}} | {{weight2}}</h5>
                {% endfor %}

                <h2>Homebuyer Pie Chart Data</h2>
                {% for homebuyer, weights in homebuyerPies %}
                    <h4>{{homebuyer}}</h4>
                    <h5>{{weights}}</h5>
                {% endfor %}

                <h2>Category Data</h2>
                {% for category, homes in categoryData %}
                    <h4>{{category}}</h4>
                    {% for home, score in homes %}
                    <h5>{{home}} --> {{score}}</h5>
                    {%  endfor %}
                {% endfor %}

                <h2>Total Score</h2>
                {% for key, value in totalScore.items %}
                    <h4>{{key}}</h4>
                    {{value}}
                {% endfor %}
            </div>
            <br>
            <div class="row">
                <div class="col-lg-4">
                    <h2>Final Grade</h2>
                    {% for key, value in totalScore.items %}
                        <h5>{{key}}</h5>
                        {% if value >= 3.5 %}
                            <h3 id="finalGrade-Ap">A+</h3>
                        {% elif value >= 3.0 %}
                            <h3 id="finalGrade-A">A</h3>
                        {% elif value >= 2.5 %}
                            <h3 id="finalGrade-B">B</h3>
                        {% elif value >= 2.2 %}
                            <h3 id="finalGrade-C">C</h3>
                        {% elif value >= 1.9 %}
                            <h3 id="finalGrade-D">D</h3>
                        {% else %}
                            <h3 id="finalGrade-F">F</h3>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock body %}

{% block scripts %}
<script src="{% static "Chart.min.js" %}"></script>
<script src="{% static "legend.js" %}"></script>
<script>
    var catLabel = [{% for category, weight1, weight2 in categoryImportance %}'{{category}}'{% if not forloop.last %},{% endif %}{% endfor %}];
    var data1 = [{% for category, weight1, weight2 in categoryImportance %}{{weight1}}*100{% if not forloop.last %},{% endif %}{% endfor %}];
    var data2 = [{% for category, weight1, weight2 in categoryImportance %}{{weight2}}*100{% if not forloop.last %},{% endif %}{% endfor %}];
    var data = {
        labels: catLabel,
        datasets: [
            {
                label: "{{ homebuyer1 }}",
                fillColor: "rgba(217, 95, 73, 0.9)",
                strokeColor: "rgba(217, 95, 73, 0.8)",
                highlightFill: "rgba(217, 95, 73, 0.8)",
                highlightStroke: "rgba(217, 95, 73, 1)",
                data: data1
            },
            {
                label: "{{ homebuyer2 }}",
                fillColor: "rgba(237, 194, 51, 0.9)",
                strokeColor: "rgba(237, 194, 51, 0.8)",
                highlightFill: "rgba(237, 194, 51, 0.8)",
                highlightStroke: "rgba(237, 194, 51, 1)",
                data: data2
            }
        ]
    };
    var ctx = document.getElementById("myChart").getContext("2d");
    var myBarChart = new Chart(ctx).Bar(data, {
        barShowStroke: false,
        scaleShowGridLines: false,
        barValueSpacing : 20,
        showTooltips: false,
    });
    legend(document.getElementById("barLegend"), myBarChart);
    
    var pie = [
    {% for color, category, weight in pieAve %}
        {
            value : {{weight}},
            color : '{{color}}',
            label : '{{category}}'
        }{% if not forloop.last %},{% endif %}
    {% endfor %}
    ]
    
    var ctx = document.getElementById("PieChart").getContext("2d");
    var pieChart = new Chart(ctx).Pie(pie,{
        barShowStroke: false,
        scaleShowGridLines: false,
        barValueSpacing : 20,
    });
    legend(document.getElementById("lineLegend"), pie);
    
    var houseLabel = [
    {% for house, score, color in categoryData.0.1 %}
        "{{house}}".substring(0, 10){% if not forloop.last %},{% endif %}
    {% endfor %}
    ]

    {% for category, houses in categoryData %}
        var {{category}}Score = [{% for house, score, color in houses %}({{ score }} / {{ largestScore }}*10){% if not forloop.last %},{% endif %}{% endfor %}];
        var {{category}}Data = {
        labels: houseLabel,
        datasets: [
            {
                label: "{{ category }}",
                fillColor: "rgba(217, 95, 73, 0.8)",
                strokeColor: "rgba(217, 95, 73, 0.8)",
                highlightFill: "{{houses.0.2}}",
                highlightStroke: "rgba(217, 95, 73, 1)",
                data: {{category}}Score
            }
        ]
    };
    {% endfor %}

    {% for category, houses in categoryData %}
        var {{category}}brx = document.getElementById("{{category}}bar").getContext("2d");
        var {{category}}Chart = new Chart({{category}}brx).Bar({{category}}Data, {
            scaleOverride : true,
            scaleSteps : 1,
            scaleStepWidth : 10,
            scaleStartValue : 0,

            barShowStroke: false,
            scaleShowGridLines: false,
            barValueSpacing : 20,
            showTooltips: false
        });

{#        {% for color, category, weight in pie1 %}#}
            {{category}}Chart.datasets[0].bars[0].fillColor = "{{ pie1.0.0 }}"; //bar 1
            {{category}}Chart.datasets[0].bars[1].fillColor = "{{ pie1.1.0 }}"; //bar 2
            {{category}}Chart.update();
{#        {% endfor %}#}
    {% endfor %}
    
</script>
{% endblock %}
